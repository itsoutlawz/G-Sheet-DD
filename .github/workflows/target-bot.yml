name: "DamDama Target Bot ✨"

on:
  push:
    branches: [ main ]
  schedule:
    - cron: '0 */1 * * *'   # Every hour at HH:00
  workflow_dispatch:
    inputs:
      max_profiles:
        description: 'Max Profiles (0 = unlimited)'
        required: false
        default: '0'
      batch_size:
        description: 'Batch Size'
        required: false
        default: '10'

env:
  PYTHON_VERSION: '3.10'
  MIN_DELAY: '0.3'
  MAX_DELAY: '0.4'
  PAGE_LOAD_TIMEOUT: '30'
  SHEET_WRITE_DELAY: '1.0'

jobs:
  run-bot:
    name: Run Target Bot
    runs-on: ubuntu-latest
    timeout-minutes: 59
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: ${{ env.PYTHON_VERSION }}

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: Run bot
        env:
          DAMADAM_USERNAME: ${{ secrets.DAMADAM_USERNAME }}
          DAMADAM_PASSWORD: ${{ secrets.DAMADAM_PASSWORD }}
          DAMADAM_USERNAME_2: ${{ secrets.DAMADAM_USERNAME_2 || '' }}
          DAMADAM_PASSWORD_2: ${{ secrets.DAMADAM_PASSWORD_2 || '' }}
          GOOGLE_SHEET_URL: ${{ secrets.GOOGLE_SHEET_URL }}
          GOOGLE_CREDENTIALS_JSON: ${{ secrets.GOOGLE_CREDENTIALS_JSON }}
          MAX_PROFILES: ${{ github.event.inputs.max_profiles || '0' }}
          BATCH_SIZE: ${{ github.event.inputs.batch_size || '10' }}
        run: |
          if [ -z "$DAMADAM_USERNAME" ] || [ -z "$DAMADAM_PASSWORD" ] || [ -z "$GOOGLE_SHEET_URL" ] || [ -z "$GOOGLE_CREDENTIALS_JSON" ]; then
            echo "❌ Error: Required environment variables are not set"
            exit 1
          fi
          
          # Create credentials file
          echo "$GOOGLE_CREDENTIALS_JSON" > credentials.json
          
          # Run the bot
          python Scraper.py